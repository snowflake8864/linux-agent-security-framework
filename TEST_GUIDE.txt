# eBPF Linux Agent Security Framework - æ‰‹åŠ¨æµ‹è¯•æŒ‡å—

## æ¦‚è¿°
æœ¬æ¡†æ¶æä¾›æ–‡ä»¶/è¿›ç¨‹é˜»æ–­å’Œç½‘ç»œåŒ…ä¿®æ”¹åŠŸèƒ½ã€‚é€šè¿‡eBPF LSMå’ŒXDPå®ç°ã€‚

## ç¯å¢ƒå‡†å¤‡
- Linuxå†…æ ¸æ”¯æŒeBPF
- Rustç¯å¢ƒ
- ç½‘ç»œæ¥å£æƒé™

## ç¼–è¯‘
```bash
# æ„å»ºåº”ç”¨
cargo build --release --target x86_64-unknown-linux-musl --bin demo
cargo build --release --target x86_64-unknown-linux-musl --bin netmod

# æ„å»ºBPFå¯¹è±¡
cargo run -p xtask -- build-bpf
```

## æµ‹è¯•æ­¥éª¤

### 1. æ–‡ä»¶é˜»æ–­æµ‹è¯•
**ç›®æ ‡**: éªŒè¯LSMæ–‡ä»¶æ“ä½œé˜»æ–­

**æ­¥éª¤**:
1. å‡†å¤‡é…ç½®æ–‡ä»¶ `config.json` (åŒ…å«file_rules)
2. è¿è¡Œdemo: `sudo ./target/x86_64-unknown-linux-musl/release/demo config.json`
3. è§‚å¯Ÿè¾“å‡º: "âœ“ Attached: enforce_file_open"
4. åœ¨å¦ä¸€ä¸ªterminalå°è¯•: `touch /tmp/ebpf_test_file`
5. é¢„æœŸç»“æœ: å‘½ä»¤å¤±è´¥ï¼Œ"Permission denied"

**éªŒè¯**:
- demoæ—¥å¿—æ˜¾ç¤ºæ–‡ä»¶è®¿é—®äº‹ä»¶
- touchå‘½ä»¤è¿”å›é0é€€å‡ºç 

### 2. è¿›ç¨‹é˜»æ–­æµ‹è¯•
**ç›®æ ‡**: éªŒè¯LSMè¿›ç¨‹æ‰§è¡Œé˜»æ–­

**æ­¥éª¤**:
1. demoè¿è¡Œä¸­
2. åœ¨å¦ä¸€ä¸ªterminalè¿è¡Œ: `nc.openbsd localhost 1234`
3. é¢„æœŸç»“æœ: è¿›ç¨‹å¯åŠ¨å¤±è´¥

**éªŒè¯**:
- ncå‘½ä»¤æ— æ³•æ‰§è¡Œ
- demoæ—¥å¿—æ˜¾ç¤ºè¿›ç¨‹é˜»æ–­äº‹ä»¶

### 3. ç½‘ç»œåŒ…ä¿®æ”¹æµ‹è¯•
**ç›®æ ‡**: éªŒè¯XDP TCP flagä¿®æ”¹

**æ­¥éª¤**:
1. å‡†å¤‡netmodé…ç½® `netmod_config.json`:
   ```json
   {
     "rules": [
       {
         "match_rule": {
           "protocol": "tcp",
           "dst_port": 80
         },
         "modification": {
           "tcp_flags": {
             "set_reserved": true
           }
         }
       }
     ]
   }
   ```
2. è¿è¡Œnetmod: `sudo ./target/x86_64-unknown-linux-musl/release/netmod --interface eth0 --config netmod_config.json`
3. è§‚å¯Ÿè¾“å‡º: "âœ… XDP packet processing active!"
4. å‘é€TCPæ•°æ®: `echo "test" | nc -w 1 192.168.134.81 80`
5. åœ¨ç›®æ ‡æœºå™¨ç›‘å¬: `nc -l 80`

**éªŒè¯**:
- netmodæ˜¾ç¤ºè§„åˆ™åŠ è½½
- ç›®æ ‡æœºå™¨æ¥æ”¶æ•°æ®
- æŠ“åŒ…éªŒè¯TCP SYN flagsçš„CWRå’ŒECEä½ä¸º1

### 4. æŒç»­ç›‘å¬æµ‹è¯•
**ç›®æ ‡**: éªŒè¯é•¿æœŸè¿è¡Œå’Œä¿¡å·å¤„ç†

**æ­¥éª¤**:
1. è¿è¡Œdemoæˆ–netmod
2. å‘é€ä¿¡å·: `kill -TERM <pid>` æˆ– Ctrl+C
3. é¢„æœŸç»“æœ: ä¼˜é›…é€€å‡ºï¼Œæ¸…ç†eBPFç¨‹åº

**éªŒè¯**:
- ç¨‹åºè¾“å‡º"graceful shutdown"
- ç³»ç»Ÿæ— æ®‹ç•™eBPFç¨‹åº

## æ•…éšœæ’é™¤
- **æƒé™é”™è¯¯**: ä½¿ç”¨sudoè¿è¡Œ
- **æ¥å£é”™è¯¯**: æ£€æŸ¥ `ip link show`ï¼Œä½¿ç”¨UPçŠ¶æ€æ¥å£
- **ç¼–è¯‘å¤±è´¥**: ç¡®ä¿muslå·¥å…·é“¾å®‰è£…
- **è§„åˆ™ä¸ç”Ÿæ•ˆ**: æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•

## é¢„æœŸè¾“å‡ºç¤ºä¾‹
```
ğŸŒ Linux Agent Security Framework Demo
âœ“ Loaded configuration
âœ“ Loaded BPF object
âœ“ Loaded BTF
âœ“ Attached: enforce_file_open
ğŸ”’ LSM hooks active
```

## æ³¨æ„äº‹é¡¹
- æµ‹è¯•å‰å¤‡ä»½é‡è¦æ•°æ®
- åœ¨éš”ç¦»ç¯å¢ƒæµ‹è¯•ç½‘ç»œåŠŸèƒ½
- ç›‘æ§ç³»ç»Ÿæ—¥å¿—: `dmesg | grep bpf`